<template>
  <div class="my-5">
    <div>
      <h2 class="h2">Editor</h2>
    </div>
    <Button @click="setIsActive" class="btn my-3 p-3 bg-blue-400 rounded text-white font-bold">Edit</Button>
    <div class="container flex justify-center">
      <div v-if="isActive" class="mt-5 popup">
        <div class="flex flex-row items-center my-2">
          <label>Change Background Color</label>
          <input v-model="color" id="color" type="color">
        </div>
        <div ref="editor" :style="{background: color}" class="text-left">
        </div>
        <button @click="Close" class="btn p-3 bg-gray-400 mt-3 text-white">Close</button>
      </div>
    </div>
    <div class="result p-3" v-if="content" v-html="content" :style="{background: color}">
    </div>
  </div>
</template>

<script>
import "quill/dist/quill.bubble.css";
import "quill/dist/quill.core.css";
import "quill/dist/quill.snow.css";
import undo_icon from "../icons/downicon.svg";
import redo_icon from "../icons/downicon.svg";
import Quill from "quill";

export default {
  name: "App",
  components: {},
  data() {
    let self = this;
    var icons = Quill.import("ui/icons");
    icons["undo"] = `<svg width="16" height="14" viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10.5 3.25H2.88438L5.12625 1.00875L4.25 0.125L0.5 3.875L4.25 7.625L5.12625 6.74063L2.88625 4.5H10.5C11.4946 4.5 12.4484 4.89509 13.1517 5.59835C13.8549 6.30161 14.25 7.25544 14.25 8.25C14.25 9.24456 13.8549 10.1984 13.1517 10.9017C12.4484 11.6049 11.4946 12 10.5 12H5.5V13.25H10.5C11.8261 13.25 13.0979 12.7232 14.0355 11.7855C14.9732 10.8479 15.5 9.57608 15.5 8.25C15.5 6.92392 14.9732 5.65215 14.0355 4.71447C13.0979 3.77678 11.8261 3.25 10.5 3.25Z" fill="#212529"/>
      </svg>`;
    icons["redo"] = `<svg width="16" height="14" viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M5.5 3.25H13.1156L10.8737 1.00875L11.75 0.125L15.5 3.875L11.75 7.625L10.8737 6.74062L13.1137 4.5H5.5C4.50544 4.5 3.55161 4.89509 2.84835 5.59835C2.14509 6.30161 1.75 7.25544 1.75 8.25C1.75 9.24456 2.14509 10.1984 2.84835 10.9017C3.55161 11.6049 4.50544 12 5.5 12H10.5V13.25H5.5C4.17392 13.25 2.90215 12.7232 1.96447 11.7855C1.02678 10.8479 0.5 9.57608 0.5 8.25C0.5 6.92392 1.02678 5.65215 1.96447 4.71447C2.90215 3.77678 4.17392 3.25 5.5 3.25Z" fill="#212529"/>
    </svg>`;
    icons["link"] = `<svg width="20" height="15" viewBox="0 0 20 15" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M18.2813 1.22503C17.9329 0.875428 17.5189 0.598039 17.0631 0.408769C16.6073 0.219499 16.1186 0.12207 15.625 0.12207C15.1315 0.12207 14.6428 0.219499 14.187 0.408769C13.7312 0.598039 13.3172 0.875428 12.9688 1.22503L13.8563 2.11253C14.089 1.87984 14.3652 1.69526 14.6692 1.56934C14.9733 1.44341 15.2991 1.37859 15.6282 1.37859C15.9572 1.37859 16.2831 1.44341 16.5871 1.56934C16.8911 1.69526 17.1674 1.87984 17.4 2.11253C17.6327 2.34521 17.8173 2.62145 17.9432 2.92547C18.0692 3.22949 18.134 3.55533 18.134 3.8844C18.134 4.21347 18.0692 4.53931 17.9432 4.84333C17.8173 5.14735 17.6327 5.42359 17.4 5.65628L12.4 10.6563C11.9309 11.1262 11.2944 11.3905 10.6304 11.3911C9.96638 11.3917 9.32935 11.1285 8.85942 10.6594C8.38949 10.1903 8.12515 9.55373 8.12457 8.88974C8.12398 8.22574 8.38719 7.58871 8.85629 7.11878L9.73754 6.23128L8.85629 5.34378L7.96879 6.23128C7.61919 6.57966 7.3418 6.99364 7.15253 7.44946C6.96326 7.90527 6.86583 8.39397 6.86583 8.88753C6.86583 9.38108 6.96326 9.86978 7.15253 10.3256C7.3418 10.7814 7.61919 11.1954 7.96879 11.5438C8.67597 12.2419 9.63134 12.6308 10.625 12.625C11.1205 12.6271 11.6114 12.5309 12.0695 12.3421C12.5276 12.1533 12.9437 11.8756 13.2938 11.525L18.2938 6.52503C18.9944 5.82025 19.3866 4.86619 19.3842 3.87244C19.3819 2.87869 18.9852 1.9265 18.2813 1.22503Z" fill="#212529"/>
<path d="M2.61879 12.5125C2.38541 12.2802 2.20022 12.0041 2.07386 11.7C1.94749 11.396 1.88244 11.0699 1.88244 10.7407C1.88244 10.4114 1.94749 10.0853 2.07386 9.78126C2.20022 9.47719 2.38541 9.20107 2.61879 8.96878L7.61879 3.96878C7.85109 3.7354 8.1272 3.55021 8.43127 3.42384C8.73534 3.29748 9.06138 3.23243 9.39067 3.23243C9.71995 3.23243 10.046 3.29748 10.3501 3.42384C10.6541 3.55021 10.9302 3.7354 11.1625 3.96878C11.3944 4.2029 11.577 4.48119 11.6994 4.78716C11.8218 5.09313 11.8815 5.42055 11.875 5.75003C11.8769 6.08053 11.8133 6.40813 11.6878 6.71388C11.5623 7.01962 11.3774 7.29745 11.1438 7.53128L9.81879 8.87503L10.7063 9.76253L12.0313 8.43753C12.7366 7.73222 13.1328 6.77561 13.1328 5.77815C13.1328 4.78069 12.7366 3.82409 12.0313 3.11878C11.326 2.41347 10.3694 2.01723 9.37192 2.01723C8.37446 2.01723 7.41785 2.41347 6.71254 3.11878L1.71254 8.11878C1.362 8.46728 1.08382 8.88164 0.893994 9.33804C0.704168 9.79443 0.606445 10.2839 0.606445 10.7782C0.606445 11.2725 0.704168 11.7619 0.893994 12.2183C1.08382 12.6747 1.362 13.089 1.71254 13.4375C2.42431 14.1303 3.38185 14.5124 4.37504 14.5C5.37698 14.501 6.33862 14.1055 7.05004 13.4L6.16254 12.5125C5.93025 12.7459 5.65413 12.9311 5.35006 13.0575C5.04599 13.1838 4.71995 13.2489 4.39067 13.2489C4.06138 13.2489 3.73534 13.1838 3.43127 13.0575C3.1272 12.9311 2.85109 12.7459 2.61879 12.5125Z" fill="#212529"/>
</svg>`
    icons["image"] = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M9.875 6.75C10.2458 6.75 10.6084 6.64003 10.9167 6.43401C11.225 6.22798 11.4654 5.93514 11.6073 5.59253C11.7492 5.24992 11.7863 4.87292 11.714 4.50921C11.6416 4.14549 11.463 3.8114 11.2008 3.54917C10.9386 3.28695 10.6045 3.10837 10.2408 3.03603C9.87708 2.96368 9.50008 3.00081 9.15747 3.14273C8.81486 3.28464 8.52202 3.52496 8.31599 3.83331C8.10997 4.14165 8 4.50416 8 4.875C8 5.37228 8.19754 5.84919 8.54917 6.20083C8.90081 6.55246 9.37772 6.75 9.875 6.75ZM9.875 4.25C9.99861 4.25 10.1195 4.28666 10.2222 4.35533C10.325 4.42401 10.4051 4.52162 10.4524 4.63582C10.4997 4.75003 10.5121 4.87569 10.488 4.99693C10.4639 5.11817 10.4044 5.22953 10.3169 5.31694C10.2295 5.40435 10.1182 5.46388 9.99693 5.48799C9.87569 5.51211 9.75003 5.49973 9.63582 5.45243C9.52162 5.40512 9.42401 5.32501 9.35533 5.22223C9.28666 5.11945 9.25 4.99861 9.25 4.875C9.25 4.70924 9.31585 4.55027 9.43306 4.43306C9.55027 4.31585 9.70924 4.25 9.875 4.25Z" fill="#212529"/>
<path d="M14.25 0.5H1.75C1.41848 0.5 1.10054 0.631696 0.866116 0.866116C0.631696 1.10054 0.5 1.41848 0.5 1.75V14.25C0.5 14.5815 0.631696 14.8995 0.866116 15.1339C1.10054 15.3683 1.41848 15.5 1.75 15.5H14.25C14.5815 15.5 14.8995 15.3683 15.1339 15.1339C15.3683 14.8995 15.5 14.5815 15.5 14.25V1.75C15.5 1.41848 15.3683 1.10054 15.1339 0.866116C14.8995 0.631696 14.5815 0.5 14.25 0.5ZM14.25 14.25H1.75V10.5L4.875 7.375L8.36875 10.8687C8.60295 11.1016 8.91977 11.2322 9.25 11.2322C9.58023 11.2322 9.89705 11.1016 10.1313 10.8687L11.125 9.875L14.25 13V14.25ZM14.25 11.2312L12.0063 8.9875C11.772 8.75469 11.4552 8.62401 11.125 8.62401C10.7948 8.62401 10.478 8.75469 10.2437 8.9875L9.25 9.98125L5.75625 6.4875C5.52205 6.25469 5.20523 6.12401 4.875 6.12401C4.54477 6.12401 4.22795 6.25469 3.99375 6.4875L1.75 8.73125V1.75H14.25V11.2312Z" fill="#212529"/>
</svg>`
    icons["code"] = `<svg width="20" height="10" viewBox="0 0 20 10" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M19.375 5L15 9.375L14.1187 8.49375L17.6063 5L14.1187 1.50625L15 0.625L19.375 5ZM0.625 5L5 0.625L5.88125 1.50625L2.39375 5L5.88125 8.49375L5 9.375L0.625 5Z" fill="#212529"/>
</svg>`
    icons["code-block"] = `<svg width="20" height="14" viewBox="0 0 20 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M19.375 7L15 11.375L14.1187 10.4937L17.6063 7L14.1187 3.50625L15 2.625L19.375 7ZM0.625 7L5 2.625L5.88125 3.50625L2.39375 7L5.88125 10.4937L5 11.375L0.625 7ZM7.7625 12.9275L11.025 0.75L12.2325 1.07313L8.97 13.25L7.7625 12.9275Z" fill="#212529"/>
</svg>`
    icons["blockquote"] = `<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M7.5 9.375H3.81875C3.93491 8.60146 4.21112 7.86066 4.62974 7.1999C5.04837 6.53914 5.6002 5.97295 6.25 5.5375L7.36875 4.7875L6.68125 3.75L5.5625 4.5C4.6208 5.12755 3.84857 5.97785 3.31433 6.97545C2.7801 7.97305 2.50038 9.08711 2.5 10.2188V14.375C2.5 14.7065 2.6317 15.0245 2.86612 15.2589C3.10054 15.4933 3.41848 15.625 3.75 15.625H7.5C7.83152 15.625 8.14946 15.4933 8.38388 15.2589C8.6183 15.0245 8.75 14.7065 8.75 14.375V10.625C8.75 10.2935 8.6183 9.97554 8.38388 9.74112C8.14946 9.5067 7.83152 9.375 7.5 9.375ZM16.25 9.375H12.5688C12.6849 8.60146 12.9611 7.86066 13.3797 7.1999C13.7984 6.53914 14.3502 5.97295 15 5.5375L16.1188 4.7875L15.4375 3.75L14.3125 4.5C13.3708 5.12755 12.5986 5.97785 12.0643 6.97545C11.5301 7.97305 11.2504 9.08711 11.25 10.2188V14.375C11.25 14.7065 11.3817 15.0245 11.6161 15.2589C11.8505 15.4933 12.1685 15.625 12.5 15.625H16.25C16.5815 15.625 16.8995 15.4933 17.1339 15.2589C17.3683 15.0245 17.5 14.7065 17.5 14.375V10.625C17.5 10.2935 17.3683 9.97554 17.1339 9.74112C16.8995 9.5067 16.5815 9.375 16.25 9.375Z" fill="#212529"/>
</svg>`
    icons["list"]["ordered"] = `<svg width="17" height="14" viewBox="0 0 17 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M2.375 4.5C3.41053 4.5 4.25 3.66053 4.25 2.625C4.25 1.58947 3.41053 0.75 2.375 0.75C1.33947 0.75 0.5 1.58947 0.5 2.625C0.5 3.66053 1.33947 4.5 2.375 4.5Z" fill="#212529"/>
<path d="M2.375 13.25C3.41053 13.25 4.25 12.4105 4.25 11.375C4.25 10.3395 3.41053 9.5 2.375 9.5C1.33947 9.5 0.5 10.3395 0.5 11.375C0.5 12.4105 1.33947 13.25 2.375 13.25Z" fill="#212529"/>
<path d="M8 10.75H16.75V12H8V10.75ZM8 2H16.75V3.25H8V2Z" fill="#212529"/>
</svg>
`
    icons["list"]["bullet"] = `<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8 11.75H16.75V13H8V11.75ZM8 3H16.75V4.25H8V3ZM3 5.5V0.5H1.75V1.125H0.5V2.375H1.75V5.5H0.5V6.75H4.25V5.5H3ZM4.25 15.5H0.5V13C0.5 12.6685 0.631696 12.3505 0.866116 12.1161C1.10054 11.8817 1.41848 11.75 1.75 11.75H3V10.5H0.5V9.25H3C3.33152 9.25 3.64946 9.3817 3.88388 9.61612C4.1183 9.85054 4.25 10.1685 4.25 10.5V11.75C4.25 12.0815 4.1183 12.3995 3.88388 12.6339C3.64946 12.8683 3.33152 13 3 13H1.75V14.25H4.25V15.5Z" fill="#212529"/>
</svg>
`
    icons["clean"] = `<svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17.3988 9.3575L12.4081 4.36625C12.1736 4.13187 11.8556 4.00021 11.5241 4.00021C11.1925 4.00021 10.8745 4.13187 10.64 4.36625L7.29125 7.715L4.625 0.25H3.375L0.25 9H1.5L2.12438 7.125H5.87437L6.37625 8.63L1.86625 13.14C1.75012 13.2561 1.658 13.3939 1.59515 13.5456C1.5323 13.6973 1.49995 13.8599 1.49995 14.0241C1.49995 14.1883 1.5323 14.3508 1.59515 14.5025C1.658 14.6542 1.75012 14.792 1.86625 14.9081L4.7075 17.75H10.7013L17.3988 11.0519C17.5101 10.9406 17.5984 10.8085 17.6587 10.6631C17.719 10.5177 17.75 10.3618 17.75 10.2044C17.75 10.047 17.719 9.8911 17.6587 9.74568C17.5984 9.60026 17.5101 9.46814 17.3988 9.35687V9.3575ZM2.54063 5.875L3.9975 1.5L5.4575 5.875H2.54063ZM10.1844 16.5H5.225L2.75 14.0238L6.695 10.0794L11.65 15.0337L10.1844 16.5ZM12.5344 14.15L7.57938 9.19563L11.5244 5.25L16.4788 10.2044L12.5344 14.15Z" fill="#212529"/>
</svg>`
    icons["align"][""] = `<svg width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M4.5 1.75H13.25V3H4.5V1.75ZM4.5 5.5H10.75V6.75H4.5V5.5ZM4.5 9.25H13.25V10.5H4.5V9.25ZM4.5 13H10.75V14.25H4.5V13ZM0.75 0.5H2V15.5H0.75V0.5Z" fill="#212529"/>
</svg>`

    return {
      toolbar_settings: {
        container: [
          [
            {
              undo: undo_icon
            },
            {
              redo: redo_icon
            }
          ],
          [{'size': ['small', false, 'large', 'huge']}],
          [{'align': []}],
          [{
            'color': [
              '#212529',
              '#845ef7',
              '#1864AB',
              '#339af0',
              '#22b8cf',
              '#51cf66',
              '#fcc419',
              '#ff6b6b',
              '#f06595',
              '#ced4da',
              '#5f3dc4',
              '#1864ab',
              '#0b7285',
              '#2b8a3e',
              '#e67700',
              '#c92a2a',
              '#c2255c'
            ]
          },
            {
              'background': []
            }],
          ["bold", "italic", "underline", 'strike', 'code'],
          [{'list': 'ordered'}, {'list': 'bullet'}],
          ['link', 'image', 'code-block', 'blockquote'],
          ["clean"]
        ],
        handlers: {
          redo() {
            self.editor.history.redo();
          },
          undo() {
            self.editor.history.undo();
          }
        },
        data: ''
      },
      content: '',
      isActive: false,
      color: ''
    };
  },
  mounted() {
    this.initialize()
  },
  methods: {
    initialize() {
      setTimeout(() => {
        let options = {
          debug: this.debug,
          modules: {
            history: {
              delay: 1000,
              maxStack: 100,
              userOnly: false
            },
            toolbar: this.toolbar_settings
            // this.toolbar,
          },
          readOnly: false,
          theme: "snow"
        };

        this.editor = new Quill(this.$refs.editor, options);

        if(this.content) {
          const editor = document.getElementsByClassName('ql-editor')
          editor[0].innerHTML = this.content
        }

        this.editor.on('text-change', () => {
          let html = this.$refs.editor.children[0].innerHTML
          if (html === '<p><br></p>') html = ''
          this.submit(html)
        })

      }, 1)
    },
    submit(text) {
      this.content = text
    },
    setIsActive() {
      this.isActive = !this.isActive
      this.initialize()
    },
    Close() {
      this.isActive = false
    }
  }
};
</script>

<style>
@import "~quill/dist/quill.bubble.css";
@import "~quill/dist/quill.snow.css";
@import "~quill/dist/quill.core.css";

.ql-size-small {
  font-size: 0.75em;
}

.ql-size-large {
  font-size: 1.5em;
}

.ql-size-huge {
  font-size: 2.5em;
}

/*.ql-picker-label svg{
  width: 0px !important;
}

.ql-header,
.ql-size .ql-picker-label:after {

  color: black !important;
  content: url("/downicon.svg");
  position: absolute;
  top: 1px !important;
  right: 0;
}*/

.popup {
  position: fixed;
  padding: 50px;
  border: 1px solid #c4c4c4;
  border-radius: 10px;
  top: 200px;
  background: white;
  display: flex;
  align-content: center;
  flex-direction: column;
  box-shadow: 0px 0px 50px 10px rgba(0, 0, 0, 0.25);
}

#color {
  width: 25px;
}

</style>
